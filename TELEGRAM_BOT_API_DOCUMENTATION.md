# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è API –¥–ª—è Telegram Bot
## –ì—Ä–∞—Ñ—ñ–∫ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å –µ–ª–µ–∫—Ç—Ä–æ–µ–Ω–µ—Ä–≥—ñ—ó - –ó–∞–ø–æ—Ä—ñ–∑—å–∫–∞ –æ–±–ª–∞—Å—Ç—å

---

## –ó–º—ñ—Å—Ç
1. [–û–≥–ª—è–¥](#–æ–≥–ª—è–¥)
2. [–ë–∞–∑–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è](#–±–∞–∑–æ–≤–∞-—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è)
3. [API Endpoints](#api-endpoints)
   - [–†–æ–∑–∫–ª–∞–¥–∏ (Schedules)](#—Ä–æ–∑–∫–ª–∞–¥–∏-schedules)
   - [–û–Ω–æ–≤–ª–µ–Ω–Ω—è (Updates)](#–æ–Ω–æ–≤–ª–µ–Ω–Ω—è-updates)
4. [–ü—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –±–æ—Ç—ñ](#–ø—Ä–∏–∫–ª–∞–¥–∏-–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è-–≤-–±–æ—Ç—ñ)
5. [–°—Ü–µ–Ω–∞—Ä—ñ—ó –¥–ª—è –±–æ—Ç–∞](#—Å—Ü–µ–Ω–∞—Ä—ñ—ó-–¥–ª—è-–±–æ—Ç–∞)
6. [Rate Limiting](#rate-limiting)
7. [–û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫](#–æ–±—Ä–æ–±–∫–∞-–ø–æ–º–∏–ª–æ–∫)
8. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó](#—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó)

---

## –û–≥–ª—è–¥

API –Ω–∞–¥–∞—î –¥–æ—Å—Ç—É–ø –¥–æ –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ –ø–ª–∞–Ω–æ–≤–∏—Ö –≤—ñ–¥–∫–ª—é—á–µ–Ω—å –µ–ª–µ–∫—Ç—Ä–æ–µ–Ω–µ—Ä–≥—ñ—ó –≤ –ó–∞–ø–æ—Ä—ñ–∑—å–∫—ñ–π –æ–±–ª–∞—Å—Ç—ñ.
–î–∞–Ω—ñ –ø–∞—Ä—Å—è—Ç—å—Å—è –∑ –æ—Ñ—ñ—Ü—ñ–π–Ω–æ–≥–æ Telegram –∫–∞–Ω–∞–ª—É –æ–±–ªener–≥–æ —Ç–∞ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–æ–º—É –≤–∏–≥–ª—è–¥—ñ.

**–û—Å–Ω–æ–≤–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ:**
- –û—Ç—Ä–∏–º–∞–Ω–Ω—è –∞–∫—Ç—É–∞–ª—å–Ω–∏—Ö –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å –ø–æ —á–µ—Ä–≥–∞—Ö (1.1, 1.2, 2.1, 2.2, 3.1, 3.2)
- –ü–æ—à—É–∫ –∞–¥—Ä–µ—Å –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —á–µ—Ä–≥–∏
- –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –Ω–æ–≤–∏—Ö —Ç–∞ –∑–º—ñ–Ω–µ–Ω–∏—Ö –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ –∑ –ø–æ–∑–Ω–∞—á–∫–æ—é –¥–∂–µ—Ä–µ–ª–∞
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –≥—Ä–∞—Ñ—ñ–∫—É –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É –¥–∞—Ç—É

---

## –ë–∞–∑–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è

### Base URL
```
http://localhost:3000/api
```
*(–£ production –∑–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω)*

### –§–æ—Ä–º–∞—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π
–í—Å—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –ø–æ–≤–µ—Ä—Ç–∞—é—Ç—å—Å—è –≤ JSON —Ñ–æ—Ä–º–∞—Ç—ñ –∑ –Ω–∞—Å—Ç—É–ø–Ω–æ—é —Å—Ç—Ä—É–∫—Ç—É—Ä–æ—é:

**–£—Å–ø—ñ—à–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "success": true,
  "data": { ... }
}
```

**–ü–æ–º–∏–ª–∫–∞:**
```json
{
  "success": false,
  "error": "–û–ø–∏—Å –ø–æ–º–∏–ª–∫–∏"
}
```

### –§–æ—Ä–º–∞—Ç –¥–∞—Ç–∏
- –î–∞—Ç–∞: `YYYY-MM-DD` (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: `2025-11-22`)
- –ß–∞—Å: `HH:MM` (24-–≥–æ–¥–∏–Ω–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥: `08:00`)

### –§–æ—Ä–º–∞—Ç —á–µ—Ä–≥–∏
- –ß–µ—Ä–≥–∞: `X.X` (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: `1.1`, `2.2`, `3.1`)

### –î–∂–µ—Ä–µ–ª–∞ –¥–∞–Ω–∏—Ö
API –∑–±–∏—Ä–∞—î –¥–∞–Ω—ñ –∑ –¥–≤–æ—Ö –¥–∂–µ—Ä–µ–ª:

1. **Telegram –∫–∞–Ω–∞–ª** (`source: "telegram"`)
   - –û—Ñ—ñ—Ü—ñ–π–Ω–∏–π –∫–∞–Ω–∞–ª –æ–±–ªenergo
   - –û–Ω–æ–≤–ª—é—î—Ç—å—Å—è –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
   - ID –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å: –º–∞–ª—ñ —á–∏—Å–ª–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: 2537)

2. **–û—Ñ—ñ—Ü—ñ–π–Ω–∏–π —Å–∞–π—Ç** (`source: "zoe"`)
   - https://www.zoe.com.ua
   - –†–µ–∑–µ—Ä–≤–Ω–µ –¥–∂–µ—Ä–µ–ª–æ –¥–∞–Ω–∏—Ö
   - ID: timestamp (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: 1733274000000)

**–õ–æ–≥—ñ–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:**
- –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±–∏—Ä–∞—î –Ω–∞–π—Å–≤—ñ–∂—ñ—à—ñ –¥–∞–Ω—ñ –∑ –æ–±–æ—Ö –¥–∂–µ—Ä–µ–ª
- –Ø–∫—â–æ –∫–æ–Ω—Ç–µ–Ω—Ç —ñ–¥–µ–Ω—Ç–∏—á–Ω–∏–π, –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –º–µ—Ç–∞–¥–∞–Ω—ñ
- –í—Å—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ API –º—ñ—Å—Ç—è—Ç—å –ø–æ–ª–µ `source` –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –¥–∂–µ—Ä–µ–ª–∞

---

## API Endpoints

### –†–æ–∑–∫–ª–∞–¥–∏ (Schedules)

#### 1. –û—Ç—Ä–∏–º–∞—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—ñ–π –¥–æ—Å—Ç—É–ø–Ω–∏–π –≥—Ä–∞—Ñ—ñ–∫

```http
GET /api/schedules/latest
```

**–û–ø–∏—Å:** –ü–æ–≤–µ—Ä—Ç–∞—î –Ω–∞–π–Ω–æ–≤—ñ—à–∏–π –¥–æ—Å—Ç—É–ø–Ω–∏–π –≥—Ä–∞—Ñ—ñ–∫ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å –¥–ª—è –≤—Å—ñ—Ö —á–µ—Ä–≥.

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "success": true,
  "date": "2025-11-22",
  "queues": [
    {
      "queue": "1.1",
      "intervals": [
        { "start": "08:00", "end": "12:00" },
        { "start": "16:00", "end": "20:00" }
      ]
    },
    {
      "queue": "1.2",
      "intervals": [
        { "start": "12:00", "end": "16:00" }
      ]
    }
  ]
}
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –±–æ—Ç—ñ:**
```
/today - –ü–æ–∫–∞–∑–∞—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ
/schedule - –ü–æ–∫–∞–∑–∞—Ç–∏ –∞–∫—Ç—É–∞–ª—å–Ω–∏–π –≥—Ä–∞—Ñ—ñ–∫
```

---

#### 2. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –≥—Ä–∞—Ñ—ñ–∫—É –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ

```http
GET /api/schedules/today/status
```

**–û–ø–∏—Å:** –®–≤–∏–¥–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ –æ–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–∏–π –≥—Ä–∞—Ñ—ñ–∫ –Ω–∞ –ø–æ—Ç–æ—á–Ω—É –¥–∞—Ç—É.

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "success": true,
  "today": "2025-11-22",
  "available": true,
  "message": "–ì—Ä–∞—Ñ—ñ–∫ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ –¥–æ—Å—Ç—É–ø–Ω–∏–π"
}
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –±–æ—Ç—ñ:**
```
–ö–æ—Ä–∏—Å–Ω–æ –¥–ª—è —Å—Ç–∞—Ä—Ç—É: —è–∫—â–æ –Ω–µ–º–∞—î –≥—Ä–∞—Ñ—ñ–∫—É - –ø–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
```

---

#### 3. –û—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –≤—Å—ñ—Ö –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –¥–∞—Ç

```http
GET /api/schedules/dates
```

**–û–ø–∏—Å:** –ü–æ–≤–µ—Ä—Ç–∞—î —Å–ø–∏—Å–æ–∫ –≤—Å—ñ—Ö –¥–∞—Ç, –¥–ª—è —è–∫–∏—Ö —î –≥—Ä–∞—Ñ—ñ–∫–∏ –≤ –±–∞–∑—ñ.

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "success": true,
  "dates": [
    "2025-11-20",
    "2025-11-21",
    "2025-11-22",
    "2025-11-23"
  ]
}
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –±–æ—Ç—ñ:**
```
/dates - –ü–æ–∫–∞–∑–∞—Ç–∏ –≤—Å—ñ –¥–æ—Å—Ç—É–ø–Ω—ñ –¥–∞—Ç–∏
–Ü–Ω–ª–∞–π–Ω –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∞ –¥–ª—è –≤–∏–±–æ—Ä—É –¥–∞—Ç–∏
```

---

#### 4. –û—Ç—Ä–∏–º–∞—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É –¥–∞—Ç—É

```http
GET /api/schedules/:date
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏:**
- `date` - –¥–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç—ñ YYYY-MM-DD

**–ü—Ä–∏–∫–ª–∞–¥:**
```http
GET /api/schedules/2025-11-22
```

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "success": true,
  "date": "2025-11-22",
  "queues": [
    {
      "queue": "1.1",
      "intervals": [
        { "start": "08:00", "end": "12:00" }
      ]
    }
  ]
}
```

**–ü–æ–º–∏–ª–∫–∞ (–¥–∞—Ç–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞):**
```json
{
  "success": false,
  "error": "–ì—Ä–∞—Ñ—ñ–∫ –Ω–∞ 2025-11-22 –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ"
}
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –±–æ—Ç—ñ:**
```
/schedule_2025_11_22 - –ì—Ä–∞—Ñ—ñ–∫ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É –¥–∞—Ç—É
Callback query –∑ –≤–∏–±–æ—Ä—É –¥–∞—Ç–∏
```

---

#### 5. –û—Ç—Ä–∏–º–∞—Ç–∏ –º–µ—Ç–∞–¥–∞–Ω—ñ –≥—Ä–∞—Ñ—ñ–∫—É

```http
GET /api/schedules/:date/metadata
```

**–û–ø–∏—Å:** –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—é —Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≥—Ä–∞—Ñ—ñ–∫—É.

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "success": true,
  "metadata": {
    "date": "2025-11-22",
    "source": "telegram",
    "lastUpdated": "2025-11-22T10:30:00.000Z",
    "firstPublished": "2025-11-21T18:00:00.000Z",
    "updateCount": 2,
    "changeType": "modified",
    "sourcePostId": "12345",
    "messageDate": "2025-11-22"
  }
}
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –±–æ—Ç—ñ:**
```
–ü–æ–∫–∞–∑–∞—Ç–∏ –∫–æ–ª–∏ –≥—Ä–∞—Ñ—ñ–∫ –±—É–≤ –æ–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–∏–π/–æ–Ω–æ–≤–ª–µ–Ω–∏–π
–í—ñ–¥–æ–±—Ä–∞–∑–∏—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–º—ñ–Ω
```

---

#### 6. –û—Ç—Ä–∏–º–∞—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó —á–µ—Ä–≥–∏ (–æ—Å—Ç–∞–Ω–Ω—è –¥–∞—Ç–∞)

```http
GET /api/schedules/queues/:queue/latest
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏:**
- `queue` - –Ω–æ–º–µ—Ä —á–µ—Ä–≥–∏ (1.1, 1.2, 2.1, 2.2, 3.1, 3.2)

**–ü—Ä–∏–∫–ª–∞–¥:**
```http
GET /api/schedules/queues/1.1/latest
```

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "success": true,
  "queue": "1.1",
  "date": "2025-11-22",
  "intervals": [
    { "start": "08:00", "end": "12:00" },
    { "start": "16:00", "end": "20:00" }
  ]
}
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –±–æ—Ç—ñ:**
```
/myqueue - –ü–æ–∫–∞–∑–∞—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–æ—ó —á–µ—Ä–≥–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
```

---

#### 7. –û—Ç—Ä–∏–º–∞—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó —á–µ—Ä–≥–∏ —Ç–∞ –¥–∞—Ç–∏

```http
GET /api/schedules/:date/queues/:queue
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏:**
- `date` - –¥–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç—ñ YYYY-MM-DD
- `queue` - –Ω–æ–º–µ—Ä —á–µ—Ä–≥–∏

**–ü—Ä–∏–∫–ª–∞–¥:**
```http
GET /api/schedules/2025-11-22/queues/1.1
```

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "success": true,
  "queue": "1.1",
  "date": "2025-11-22",
  "intervals": [
    { "start": "08:00", "end": "12:00" }
  ]
}
```

---

### –û–Ω–æ–≤–ª–µ–Ω–Ω—è (Updates)

#### 8. –û—Ç—Ä–∏–º–∞—Ç–∏ –Ω–æ–≤—ñ –≥—Ä–∞—Ñ—ñ–∫–∏

```http
GET /api/updates/new?hours=24
```

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä–∏:**
- `hours` - –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≥–æ–¥–∏–Ω –Ω–∞–∑–∞–¥ (1-720, –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 24)

**–û–ø–∏—Å:** –ü–æ–≤–µ—Ä—Ç–∞—î –≥—Ä–∞—Ñ—ñ–∫–∏ –Ω–∞ –º–∞–π–±—É—Ç–Ω—ñ –¥–∞—Ç–∏ (–∑–∞–≤—Ç—Ä–∞ —ñ –¥–∞–ª—ñ), —è–∫—ñ –±—É–ª–∏ –æ–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω—ñ –≤–ø–µ—Ä—à–µ –∑–∞ –≤–∫–∞–∑–∞–Ω–∏–π –ø–µ—Ä—ñ–æ–¥. –ì—Ä–∞—Ñ—ñ–∫–∏ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ —ñ–≥–Ω–æ—Ä—É—é—Ç—å—Å—è, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è –Ω–∞ –≥–æ–ª–æ–≤–Ω–æ–º—É –µ–∫—Ä–∞–Ω—ñ.

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "success": true,
  "count": 2,
  "schedules": [
    {
      "date": "2025-11-23",
      "source": "telegram",
      "publishedAt": "2025-11-22T15:00:00.000Z",
      "messageDate": "2025-11-22",
      "sourcePostId": "12346",
      "pushMessage": "üì± –î–æ—Å—Ç—É–ø–Ω–∏–π –≥—Ä–∞—Ñ—ñ–∫ –∑–∞ 23 –ª–∏—Å—Ç–æ–ø–∞–¥–∞"
    }
  ]
}
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –±–æ—Ç—ñ:**
```
Push notifications –ø—Ä–æ –Ω–æ–≤—ñ –≥—Ä–∞—Ñ—ñ–∫–∏
/new - –ü–æ–∫–∞–∑–∞—Ç–∏ –Ω–æ–≤—ñ –≥—Ä–∞—Ñ—ñ–∫–∏ –∑–∞ 24 –≥–æ–¥–∏–Ω–∏
```

---

#### 9. –û—Ç—Ä–∏–º–∞—Ç–∏ –∑–º—ñ–Ω–µ–Ω—ñ –≥—Ä–∞—Ñ—ñ–∫–∏

```http
GET /api/updates/changed?hours=24
```

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä–∏:**
- `hours` - –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≥–æ–¥–∏–Ω –Ω–∞–∑–∞–¥ (1-720, –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 24)

**–û–ø–∏—Å:** –ü–æ–≤–µ—Ä—Ç–∞—î –≥—Ä–∞—Ñ—ñ–∫–∏, —è–∫—ñ –±—É–ª–∏ –∑–º—ñ–Ω–µ–Ω—ñ/–æ–Ω–æ–≤–ª–µ–Ω—ñ –∑–∞ –≤–∫–∞–∑–∞–Ω–∏–π –ø–µ—Ä—ñ–æ–¥.

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "success": true,
  "count": 1,
  "schedules": [
    {
      "date": "2025-11-22",
      "source": "telegram",
      "updatedAt": "2025-11-22T10:30:00.000Z",
      "messageDate": "2025-11-22",
      "sourcePostId": "12345",
      "updateCount": 2,
      "pushMessage": "üì± –£–≤–∞–≥–∞! –í–Ω–µ—Å–µ–Ω–æ –∑–º—ñ–Ω–∏ –∑–∞ 22 –ª–∏—Å—Ç–æ–ø–∞–¥–∞ –æ 10:30"
    }
  ]
}
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –±–æ—Ç—ñ:**
```
Push notifications –ø—Ä–æ –∑–º—ñ–Ω–∏ –≤ –≥—Ä–∞—Ñ—ñ–∫–∞—Ö
/changes - –ü–æ–∫–∞–∑–∞—Ç–∏ –∑–º—ñ–Ω–∏ –∑–∞ 24 –≥–æ–¥–∏–Ω–∏
```

**–ü—Ä–∏–º—ñ—Ç–∫–∞ –ø—Ä–æ pushMessage:**
- üì± - –¥–∞–Ω—ñ –∑ Telegram –∫–∞–Ω–∞–ª—É
- üåê - –¥–∞–Ω—ñ –∑ –æ—Ñ—ñ—Ü—ñ–π–Ω–æ–≥–æ —Å–∞–π—Ç—É

---


#### 10. –ü–æ—à—É–∫ –∞–¥—Ä–µ—Å –∑–∞ –≤—É–ª–∏—Ü–µ—é

```http
```

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä–∏:**
- `q` - –ø–æ—à—É–∫–æ–≤–∏–π –∑–∞–ø–∏—Ç (–º—ñ–Ω—ñ–º—É–º 3 —Å–∏–º–≤–æ–ª–∏)

**–ü—Ä–∏–∫–ª–∞–¥:**
```http
```

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "success": true,
  "query": "–°–æ–±–æ—Ä–Ω–∏–π",
  "count": 5,
    {
      "id": 123,
      "full_address": "–ó–∞–ø–æ—Ä—ñ–∂–∂—è, –°–æ–±–æ—Ä–Ω–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç, 1",
      "queue": "1.1"
    },
    {
      "id": 124,
      "full_address": "–ó–∞–ø–æ—Ä—ñ–∂–∂—è, –°–æ–±–æ—Ä–Ω–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç, 3",
      "queue": "1.1"
    }
  ]
}
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –±–æ—Ç—ñ:**
```
/find –≤—É–ª–∏—Ü—è - –ü–æ—à—É–∫ –∞–¥—Ä–µ—Å–∏
–Ü–Ω–ª–∞–π–Ω —Ä–µ–∂–∏–º –¥–ª—è –ø–æ—à—É–∫—É
```

---

#### 11. –ü–æ—à—É–∫ –∑–∞ —Ç–æ—á–Ω–æ—é –∞–¥—Ä–µ—Å–æ—é

```http
```

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä–∏:**
- `address` - –ø–æ–≤–Ω–∞ –∞–¥—Ä–µ—Å–∞

**–ü—Ä–∏–∫–ª–∞–¥:**
```http
```

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```json
{
  "success": true,
  "address": {
    "id": 123,
    "full_address": "–ó–∞–ø–æ—Ä—ñ–∂–∂—è, –°–æ–±–æ—Ä–Ω–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç, 1",
    "queue": "1.1"
  }
}
```

**–ü–æ–º–∏–ª–∫–∞:**
```json
{
  "success": false,
  "error": "–ê–¥—Ä–µ—Å—É \"...\" –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ –±–∞–∑—ñ"
}
```

---

## –ü—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –±–æ—Ç—ñ

### –ü—Ä–∏–∫–ª–∞–¥ 1: –ü–æ–∫–∞–∑–∞—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ

```javascript
// –ö–æ–º–∞–Ω–¥–∞ /today
async function handleTodayCommand(ctx) {
  try {
    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –≥—Ä–∞—Ñ—ñ–∫—É
    const statusRes = await fetch('http://localhost:3000/api/schedules/today/status');
    const status = await statusRes.json();

    if (!status.available) {
      return ctx.reply('‚ùå –ì—Ä–∞—Ñ—ñ–∫ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ —â–µ –Ω–µ –æ–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–∏–π');
    }

    // –û—Ç—Ä–∏–º—É—î–º–æ –≥—Ä–∞—Ñ—ñ–∫
    const scheduleRes = await fetch('http://localhost:3000/api/schedules/latest');
    const schedule = await scheduleRes.json();

    // –§–æ—Ä–º–∞—Ç—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
    let message = `üìÖ –ì—Ä–∞—Ñ—ñ–∫ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å –Ω–∞ ${formatDate(schedule.date)}\n\n`;

    schedule.queues.forEach(q => {
      message += `üîå –ß–µ—Ä–≥–∞ ${q.queue}:\n`;
      q.intervals.forEach(int => {
        message += `  ‚è∞ ${int.start} - ${int.end}\n`;
      });
      message += '\n';
    });

    ctx.reply(message);
  } catch (error) {
    ctx.reply('‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –≥—Ä–∞—Ñ—ñ–∫—É');
  }
}
```

---

### –ü—Ä–∏–∫–ª–∞–¥ 2: –ü–æ—à—É–∫ –∞–¥—Ä–µ—Å–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

```javascript
// –ö–æ–º–∞–Ω–¥–∞ /find
async function handleFindCommand(ctx) {
  const query = ctx.message.text.replace('/find', '').trim();

  if (query.length < 3) {
    return ctx.reply('‚ö†Ô∏è –í–≤–µ–¥—ñ—Ç—å –º—ñ–Ω—ñ–º—É–º 3 —Å–∏–º–≤–æ–ª–∏ –¥–ª—è –ø–æ—à—É–∫—É');
  }

  try {
    const data = await res.json();

    if (data.count === 0) {
      return ctx.reply('‚ùå –ê–¥—Ä–µ—Å–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
    }

    // –°—Ç–≤–æ—Ä—é—î–º–æ —ñ–Ω–ª–∞–π–Ω –∫–ª–∞–≤—ñ–∞—Ç—É—Ä—É –∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
      {
        text: `${addr.full_address} (–ß–µ—Ä–≥–∞ ${addr.queue})`,
        callback_data: `save_queue_${addr.queue}_${addr.id}`
      }
    ]));

    ctx.reply('üè† –ó–Ω–∞–π–¥–µ–Ω—ñ –∞–¥—Ä–µ—Å–∏:', {
      reply_markup: {
        inline_keyboard: keyboard
      }
    });
  } catch (error) {
    ctx.reply('‚ùå –ü–æ–º–∏–ª–∫–∞ –ø–æ—à—É–∫—É');
  }
}
```

---

### –ü—Ä–∏–∫–ª–∞–¥ 3: –ü—ñ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è (polling)

```javascript
// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–æ–≤–∏—Ö/–∑–º—ñ–Ω–µ–Ω–∏—Ö –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ –∫–æ–∂–Ω—ñ 15 —Ö–≤–∏–ª–∏–Ω
setInterval(async () => {
  try {
    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –Ω–æ–≤—ñ –≥—Ä–∞—Ñ—ñ–∫–∏
    const newRes = await fetch('http://localhost:3000/api/updates/new?hours=1');
    const newData = await newRes.json();

    if (newData.count > 0) {
      // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ notification –≤—Å—ñ–º –ø—ñ–¥–ø–∏—Å–∞–Ω–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º
      newData.schedules.forEach(schedule => {
        notifySubscribers(schedule.pushMessage, schedule.date);
      });
    }

    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∑–º—ñ–Ω–µ–Ω—ñ –≥—Ä–∞—Ñ—ñ–∫–∏
    const changedRes = await fetch('http://localhost:3000/api/updates/changed?hours=1');
    const changedData = await changedRes.json();

    if (changedData.count > 0) {
      changedData.schedules.forEach(schedule => {
        notifySubscribers(schedule.pushMessage, schedule.date);
      });
    }
  } catch (error) {
    console.error('Error checking updates:', error);
  }
}, 15 * 60 * 1000); // –ö–æ–∂–Ω—ñ 15 —Ö–≤–∏–ª–∏–Ω
```

---

### –ü—Ä–∏–∫–ª–∞–¥ 4: –ì—Ä–∞—Ñ—ñ–∫ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–æ—ó —á–µ—Ä–≥–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

```javascript
// –ö–æ–º–∞–Ω–¥–∞ /myqueue
async function handleMyQueueCommand(ctx) {
  const userId = ctx.from.id;

  // –û—Ç—Ä–∏–º—É—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω—É —á–µ—Ä–≥—É –∑ –ë–î –±–æ—Ç–∞
  const userQueue = await getUserQueue(userId);

  if (!userQueue) {
    return ctx.reply('‚ùå –°–ø–æ—á–∞—Ç–∫—É –∑–Ω–∞–π–¥—ñ—Ç—å —Å–≤–æ—é –∞–¥—Ä–µ—Å—É: /find –≤—É–ª–∏—Ü—è');
  }

  try {
    const res = await fetch(`http://localhost:3000/api/schedules/queues/${userQueue}/latest`);
    const data = await res.json();

    if (!data.success) {
      return ctx.reply('‚ùå –ì—Ä–∞—Ñ—ñ–∫ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
    }

    let message = `üè† –í–∞—à–∞ —á–µ—Ä–≥–∞: ${data.queue}\n`;
    message += `üìÖ –î–∞—Ç–∞: ${formatDate(data.date)}\n\n`;
    message += `üîå –í—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è:\n`;

    data.intervals.forEach(int => {
      message += `  ‚è∞ ${int.start} - ${int.end}\n`;
    });

    ctx.reply(message);
  } catch (error) {
    ctx.reply('‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –≥—Ä–∞—Ñ—ñ–∫—É');
  }
}
```

---

## –°—Ü–µ–Ω–∞—Ä—ñ—ó –¥–ª—è –±–æ—Ç–∞

### 1. –ë–∞–∑–æ–≤—ñ –∫–æ–º–∞–Ω–¥–∏

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å | API Endpoint |
|---------|------|--------------|
| `/start` | –ü—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è, –ø–æ–∫–∞–∑–∞—Ç–∏ –º–µ–Ω—é | - |
| `/help` | –î–æ–ø–æ–º–æ–≥–∞ | - |
| `/today` | –ì—Ä–∞—Ñ—ñ–∫ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ | `GET /api/schedules/latest` |
| `/tomorrow` | –ì—Ä–∞—Ñ—ñ–∫ –Ω–∞ –∑–∞–≤—Ç—Ä–∞ | `GET /api/schedules/:date` |
| `/dates` | –°–ø–∏—Å–æ–∫ –¥–∞—Ç | `GET /api/schedules/dates` |
| `/myqueue` | –ú—ñ–π –≥—Ä–∞—Ñ—ñ–∫ | `GET /api/schedules/queues/:queue/latest` |
| `/new` | –ù–æ–≤—ñ –≥—Ä–∞—Ñ—ñ–∫–∏ | `GET /api/updates/new?hours=24` |
| `/changes` | –ó–º—ñ–Ω–∏ –≤ –≥—Ä–∞—Ñ—ñ–∫–∞—Ö | `GET /api/updates/changed?hours=24` |

---

### 2. –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —á–µ—Ä–≥–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

**–°—Ü–µ–Ω–∞—Ä—ñ–π:**
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: `/find –°–æ–±–æ—Ä–Ω–∏–π`
2. –ë–æ—Ç –ø–æ–∫–∞–∑—É—î —Å–ø–∏—Å–æ–∫ –∞–¥—Ä–µ—Å –∑ —ñ–Ω–ª–∞–π–Ω –∫–Ω–æ–ø–∫–∞–º–∏
3. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Ç–∏—Å–∫–∞—î –Ω–∞ –∞–¥—Ä–µ—Å—É
4. –ë–æ—Ç –∑–±–µ—Ä—ñ–≥–∞—î —á–µ—Ä–≥—É –≤ –ë–î —Ç–∞ –ø–æ–∫–∞–∑—É—î –≥—Ä–∞—Ñ—ñ–∫
5. –¢–µ–ø–µ—Ä `/myqueue` –ø–æ–∫–∞–∑—É—î –≥—Ä–∞—Ñ—ñ–∫ –¥–ª—è —Ü—ñ—î—ó —á–µ—Ä–≥–∏

**Callback data format:**
```
save_queue_1.1_123
```

---

### 3. Push notifications

**–¢–∏–ø–∏ —Å–ø–æ–≤—ñ—â–µ–Ω—å:**
1. **–ù–æ–≤–∏–π –≥—Ä–∞—Ñ—ñ–∫ –æ–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–∏–π** - —â–æ–¥–Ω—è, –∫–æ–ª–∏ –∑'—è–≤–ª—è—î—Ç—å—Å—è –Ω–æ–≤–∏–π –≥—Ä–∞—Ñ—ñ–∫
2. **–ó–º—ñ–Ω–∏ –≤ –≥—Ä–∞—Ñ—ñ–∫—É** - –∫–æ–ª–∏ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è —ñ—Å–Ω—É—é—á–∏–π –≥—Ä–∞—Ñ—ñ–∫
3. **–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è** - –∑–∞ 30 —Ö–≤ –¥–æ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è (–ø–æ—Ç—Ä–µ–±—É—î –∑–Ω–∞–Ω–Ω—è —á–µ—Ä–≥–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞)

**–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:**
- Polling –∫–æ–∂–Ω—ñ 15-30 —Ö–≤–∏–ª–∏–Ω: `/api/updates/new?hours=1` —Ç–∞ `/api/updates/changed?hours=1`
- –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ –æ—Å—Ç–∞–Ω–Ω—ñ–º –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–∏–º —á–∞—Å–æ–º
- –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ø—ñ–¥–ø–∏—Å–∞–Ω–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º

---

### 4. –Ü–Ω–ª–∞–π–Ω —Ä–µ–∂–∏–º

**–ü—Ä–∏–∫–ª–∞–¥ —ñ–Ω–ª–∞–π–Ω query:**
```
@bot –°–æ–±–æ—Ä–Ω–∏–π
```

**–í—ñ–¥–ø–æ–≤—ñ–¥—å:**
```javascript
bot.on('inline_query', async (ctx) => {
  const query = ctx.inlineQuery.query;

  if (query.length < 3) return;

  const data = await res.json();

    type: 'article',
    id: String(index),
    title: addr.full_address,
    description: `–ß–µ—Ä–≥–∞: ${addr.queue}`,
    input_message_content: {
      message_text: `üè† ${addr.full_address}\nüîå –ß–µ—Ä–≥–∞: ${addr.queue}`
    }
  }));

  ctx.answerInlineQuery(results);
});
```

---

### 5. –ö–ª–∞–≤—ñ–∞—Ç—É—Ä–∏

**–ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é (ReplyKeyboardMarkup):**
```
üìÖ –ì—Ä–∞—Ñ—ñ–∫ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ  |  üîç –ó–Ω–∞–π—Ç–∏ –∞–¥—Ä–µ—Å—É
üìÜ –í—Å—ñ –¥–∞—Ç–∏           |  ‚öôÔ∏è –ú—ñ–π –≥—Ä–∞—Ñ—ñ–∫
üîî –ü—ñ–¥–ø–∏—Å–∫–∞           |  ‚ÑπÔ∏è –î–æ–ø–æ–º–æ–≥–∞
```

**–í–∏–±—ñ—Ä –¥–∞—Ç–∏ (InlineKeyboardMarkup):**
```
20.11  |  21.11  |  22.11
23.11  |  24.11  |  25.11
```

---

## Rate Limiting

### –õ—ñ–º—ñ—Ç–∏ API

| –ï–Ω–¥–ø–æ—ñ–Ω—Ç | –õ—ñ–º—ñ—Ç |
|----------|-------|
| `/api/schedules/*` | 30 –∑–∞–ø–∏—Ç—ñ–≤ / 15 —Ö–≤–∏–ª–∏–Ω |
| `/api/updates/*` | 20 –∑–∞–ø–∏—Ç—ñ–≤ / 15 —Ö–≤–∏–ª–∏–Ω |
| –ó–∞–≥–∞–ª—å–Ω–∏–π | 100 –∑–∞–ø–∏—Ç—ñ–≤ / 15 —Ö–≤–∏–ª–∏–Ω |

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è –±–æ—Ç–∞

1. **–ö–µ—à—É–≤–∞–Ω–Ω—è** - –∑–±–µ—Ä—ñ–≥–∞–π—Ç–µ –≥—Ä–∞—Ñ—ñ–∫–∏ –≤ –ø–∞–º'—è—Ç—ñ –±–æ—Ç–∞ –Ω–∞ 15-30 —Ö–≤–∏–ª–∏–Ω
2. **Batch requests** - –¥–ª—è –≥—Ä—É–ø –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ä–æ–±—ñ—Ç—å –æ–¥–∏–Ω –∑–∞–ø–∏—Ç –∑–∞–º—ñ—Å—Ç—å –±–∞–≥–∞—Ç—å–æ—Ö
3. **Polling interval** - –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–µ —á–∞—Å—Ç—ñ—à–µ –Ω—ñ–∂ –∫–æ–∂–Ω—ñ 15 —Ö–≤–∏–ª–∏–Ω
4. **Retry logic** - –ø—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ 429 (Too Many Requests) —á–µ–∫–∞–π—Ç–µ –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–∏–º –∑–∞–ø–∏—Ç–æ–º

---

## –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫

### HTTP Status Codes

| –ö–æ–¥ | –û–ø–∏—Å | –û–±—Ä–æ–±–∫–∞ –≤ –±–æ—Ç—ñ |
|-----|------|----------------|
| 200 | OK | –í—ñ–¥–æ–±—Ä–∞–∑–∏—Ç–∏ –¥–∞–Ω—ñ |
| 400 | Bad Request | –ü–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–º–∏–ª–∫—É –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó |
| 404 | Not Found | "–î–∞–Ω—ñ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ" |
| 429 | Too Many Requests | –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –ø—ñ–∑–Ω—ñ—à–µ |
| 500 | Server Error | "–¢–∏–º—á–∞—Å–æ–≤–∞ –ø–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞" |

### –ü—Ä–∏–∫–ª–∞–¥ –æ–±—Ä–æ–±–∫–∏ –ø–æ–º–∏–ª–æ–∫

```javascript
async function safeApiCall(url) {
  try {
    const res = await fetch(url);

    if (res.status === 429) {
      return { error: '–ó–∞–±–∞–≥–∞—Ç–æ –∑–∞–ø–∏—Ç—ñ–≤. –°–ø—Ä–æ–±—É–π—Ç–µ –∑–∞ —Ö–≤–∏–ª–∏–Ω—É.' };
    }

    if (res.status === 404) {
      return { error: '–î–∞–Ω—ñ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ' };
    }

    if (!res.ok) {
      return { error: '–ü–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.' };
    }

    const data = await res.json();

    if (!data.success) {
      return { error: data.error };
    }

    return { data };
  } catch (error) {
    return { error: '–ü–æ–º–∏–ª–∫–∞ –∑\'—î–¥–Ω–∞–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º' };
  }
}
```

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó

### 1. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –±–æ—Ç–∞

**–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
bot/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ commands/       # –û–±—Ä–æ–±–Ω–∏–∫–∏ –∫–æ–º–∞–Ω–¥
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ start.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ today.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ find.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ myqueue.js
‚îÇ   ‚îú‚îÄ‚îÄ services/       # –ë—ñ–∑–Ω–µ—Å –ª–æ–≥—ñ–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.js      # API –∫–ª—ñ—î–Ω—Ç
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cache.js    # –ö–µ—à—É–≤–∞–Ω–Ω—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ notifications.js
‚îÇ   ‚îú‚îÄ‚îÄ database/       # –ë–î –±–æ—Ç–∞ (–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ, —á–µ—Ä–≥–∏)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ db.js
‚îÇ   ‚îú‚îÄ‚îÄ utils/          # –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ formatters.js
‚îÇ   ‚îî‚îÄ‚îÄ index.js        # –ì–æ–ª–æ–≤–Ω–∏–π —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ .env
‚îî‚îÄ‚îÄ package.json
```

---

### 2. –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö –±–æ—Ç–∞

**–¢–∞–±–ª–∏—Ü—ñ:**
```sql
-- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ
CREATE TABLE users (
  telegram_id INTEGER PRIMARY KEY,
  queue TEXT,              -- –∑–±–µ—Ä–µ–∂–µ–Ω–∞ —á–µ—Ä–≥–∞ (1.1, 2.2, etc)
  address_id INTEGER,      -- ID –∞–¥—Ä–µ—Å–∏ –∑ API
  notifications_enabled BOOLEAN DEFAULT TRUE,
  created_at DATETIME,
  last_active DATETIME
);

-- –ü—ñ–¥–ø–∏—Å–∫–∏ –Ω–∞ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è
CREATE TABLE subscriptions (
  user_id INTEGER,
  type TEXT,  -- 'new', 'changed', 'reminder'
  enabled BOOLEAN DEFAULT TRUE
);

-- –ö–µ—à (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
CREATE TABLE cache (
  key TEXT PRIMARY KEY,
  value TEXT,
  expires_at DATETIME
);
```

---

### 3. –ö–µ—à—É–≤–∞–Ω–Ω—è

**–©–æ –∫–µ—à—É–≤–∞—Ç–∏:**
- –°–ø–∏—Å–æ–∫ –¥–∞—Ç - 30 —Ö–≤–∏–ª–∏–Ω
- –ì—Ä–∞—Ñ—ñ–∫–∏ - 30 —Ö–≤–∏–ª–∏–Ω
- –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ—à—É–∫—É –∞–¥—Ä–µ—Å - 24 –≥–æ–¥–∏–Ω–∏

**–ü—Ä–∏–∫–ª–∞–¥:**
```javascript
const cache = new Map();

async function getCachedSchedule(date) {
  const key = `schedule_${date}`;
  const cached = cache.get(key);

  if (cached && cached.expires > Date.now()) {
    return cached.data;
  }

  const data = await fetchSchedule(date);

  cache.set(key, {
    data,
    expires: Date.now() + 30 * 60 * 1000 // 30 —Ö–≤–∏–ª–∏–Ω
  });

  return data;
}
```

---

### 4. –¢–µ–∫—Å—Ç–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

**–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ñ emoji:**
- üìÖ - –¥–∞—Ç–∞, –≥—Ä–∞—Ñ—ñ–∫
- üîå - –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
- ‚è∞ - —á–∞—Å
- üè† - –∞–¥—Ä–µ—Å–∞
- üîç - –ø–æ—à—É–∫
- ‚ö†Ô∏è - –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è, –∑–º—ñ–Ω–∏
- ‚úÖ - —É—Å–ø—ñ—Ö
- ‚ùå - –ø–æ–º–∏–ª–∫–∞
- üîî - —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è

**–§–æ—Ä–º–∞—Ç –¥–∞—Ç–∏ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é:**
```javascript
function formatDateUkrainian(dateStr) {
  const months = [
    '—Å—ñ—á–Ω—è', '–ª—é—Ç–æ–≥–æ', '–±–µ—Ä–µ–∑–Ω—è', '–∫–≤—ñ—Ç–Ω—è', '—Ç—Ä–∞–≤–Ω—è', '—á–µ—Ä–≤–Ω—è',
    '–ª–∏–ø–Ω—è', '—Å–µ—Ä–ø–Ω—è', '–≤–µ—Ä–µ—Å–Ω—è', '–∂–æ–≤—Ç–Ω—è', '–ª–∏—Å—Ç–æ–ø–∞–¥–∞', '–≥—Ä—É–¥–Ω—è'
  ];

  const [year, month, day] = dateStr.split('-');
  const monthName = months[parseInt(month) - 1];

  return `${parseInt(day)} ${monthName} ${year}`;
}

// "2025-11-22" ‚Üí "22 –ª–∏—Å—Ç–æ–ø–∞–¥–∞ 2025"
```

---

### 5. Notifications Best Practices

**–ö–æ–ª–∏ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—Ç–∏:**
1. **–ù–æ–≤–∏–π –≥—Ä–∞—Ñ—ñ–∫** - –æ–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó
2. **–ó–º—ñ–Ω–∏** - –æ–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è
3. **–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è** - –∑–∞ 30 —Ö–≤, 1 –≥–æ–¥, 3 –≥–æ–¥ –¥–æ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è

**–§–æ—Ä–º–∞—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:**
```
üìÖ –ù–æ–≤–∏–π –≥—Ä–∞—Ñ—ñ–∫ –Ω–∞ 23 –ª–∏—Å—Ç–æ–ø–∞–¥–∞!

üîå –í–∞—à–∞ —á–µ—Ä–≥–∞: 1.1

‚è∞ –í—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è:
  08:00 - 12:00
  16:00 - 20:00

üîî –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è: /settings
```

**–ü—Ä–∏–∫–ª–∞–¥ –∫–æ–¥—É:**
```javascript
async function checkAndNotify() {
  const newSchedules = await getNewSchedules(1); // –æ—Å—Ç–∞–Ω–Ω—è –≥–æ–¥–∏–Ω–∞

  for (const schedule of newSchedules) {
    const users = await getUsersByQueue(schedule.queue);

    for (const user of users) {
      if (user.notifications_enabled) {
        await bot.telegram.sendMessage(
          user.telegram_id,
          formatScheduleNotification(schedule)
        );
      }
    }
  }
}
```

---

### 6. –Ü–Ω–ª–∞–π–Ω –∫–Ω–æ–ø–∫–∏

**–ü—Ä–∏–∫–ª–∞–¥ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó –ø–æ –¥–∞—Ç–∞—Ö:**
```javascript
function createDateKeyboard(dates, currentIndex = 0) {
  const prevDate = dates[currentIndex - 1];
  const nextDate = dates[currentIndex + 1];

  const keyboard = [];

  // –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó
  const navRow = [];
  if (prevDate) {
    navRow.push({
      text: '‚óÄÔ∏è –ü–æ–ø–µ—Ä–µ–¥–Ω—è',
      callback_data: `date_${prevDate}`
    });
  }
  if (nextDate) {
    navRow.push({
      text: '–ù–∞—Å—Ç—É–ø–Ω–∞ ‚ñ∂Ô∏è',
      callback_data: `date_${nextDate}`
    });
  }

  if (navRow.length > 0) {
    keyboard.push(navRow);
  }

  // –ö–Ω–æ–ø–∫–∞ "–ü–æ–∫–∞–∑–∞—Ç–∏ –≤—Å—ñ —á–µ—Ä–≥–∏"
  keyboard.push([{
    text: 'üìã –í—Å—ñ —á–µ—Ä–≥–∏',
    callback_data: `show_all_queues_${dates[currentIndex]}`
  }]);

  return keyboard;
}
```

---

### 7. –õ–æ–∫–∞–ª—ñ–∑–∞—Ü—ñ—è

–•–æ—á–∞ API –ø—ñ–¥—Ç—Ä–∏–º—É—î –º—É–ª—å—Ç–∏–º–æ–≤–Ω—ñ—Å—Ç—å (—á–µ—Ä–µ–∑ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Accept-Language`), –¥–ª—è –±–æ—Ç–∞ –∫—Ä–∞—â–µ:
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —É–∫—Ä–∞—ó–Ω—Å—å–∫—É –º–æ–≤—É –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
- –û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ –¥–æ–¥–∞—Ç–∏ —Ä–æ—Å—ñ–π—Å—å–∫—É —á–µ—Ä–µ–∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
- API –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–æ–≤–µ—Ä–Ω–µ –ª–æ–∫–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

**–ü—Ä–∏–∫–ª–∞–¥:**
```javascript
const fetch = require('node-fetch');

async function getSchedule(date, locale = 'uk') {
  const res = await fetch(`http://localhost:3000/api/schedules/${date}`, {
    headers: {
      'Accept-Language': locale
    }
  });

  return await res.json();
}
```

---

### 8. –û–±—Ä–æ–±–∫–∞ –≤–µ–ª–∏–∫–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

**–Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –±–∞–≥–∞—Ç–æ (> 1000):**

1. **Batch notifications** - –≤—ñ–¥–ø—Ä–∞–≤–ª—è–π—Ç–µ –ø–æ 30 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –Ω–∞ —Å–µ–∫—É–Ω–¥—É (–ª—ñ–º—ñ—Ç Telegram)
2. **Queue system** - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —á–µ—Ä–≥—É –¥–ª—è –æ–±—Ä–æ–±–∫–∏ (Bull, BullMQ)
3. **Database indexing** - —ñ–Ω–¥–µ–∫—Å—É–π—Ç–µ queue —Ç–∞ telegram_id
4. **Monitoring** - –ª–æ–≥—É–π—Ç–µ –ø–æ–º–∏–ª–∫–∏ —Ç–∞ –º–µ—Ç—Ä–∏–∫–∏

**–ü—Ä–∏–∫–ª–∞–¥ batch –≤—ñ–¥–ø—Ä–∞–≤–∫–∏:**
```javascript
async function sendBatchNotifications(users, message) {
  const BATCH_SIZE = 30;

  for (let i = 0; i < users.length; i += BATCH_SIZE) {
    const batch = users.slice(i, i + BATCH_SIZE);

    await Promise.all(
      batch.map(user =>
        bot.telegram.sendMessage(user.telegram_id, message)
          .catch(err => console.error(`Failed to send to ${user.telegram_id}:`, err))
      )
    );

    // –ß–µ–∫–∞—î–º–æ 1 —Å–µ–∫—É–Ω–¥—É –º—ñ–∂ –±–∞—Ç—á–∞–º–∏
    if (i + BATCH_SIZE < users.length) {
      await new Promise(resolve => setTimeout(resolve, 1000));
    }
  }
}
```

---

## –ü—Ä–∏–∫–ª–∞–¥ –ø–æ–≤–Ω–æ–≥–æ API –∫–ª—ñ—î–Ω—Ç–∞

```javascript
// services/api.js
class BlackoutAPI {
  constructor(baseURL) {
    this.baseURL = baseURL || 'http://localhost:3000/api';
  }

  async request(endpoint) {
    const res = await fetch(`${this.baseURL}${endpoint}`);

    if (!res.ok) {
      if (res.status === 429) {
        throw new Error('RATE_LIMIT');
      }
      if (res.status === 404) {
        return null;
      }
      throw new Error('API_ERROR');
    }

    return await res.json();
  }

  // Schedules
  async getLatestSchedule() {
    return this.request('/schedules/latest');
  }

  async getTodayStatus() {
    return this.request('/schedules/today/status');
  }

  async getScheduleByDate(date) {
    return this.request(`/schedules/${date}`);
  }

  async getScheduleByQueue(queue, date = null) {
    if (date) {
      return this.request(`/schedules/${date}/queues/${queue}`);
    }
    return this.request(`/schedules/queues/${queue}/latest`);
  }

  async getAllDates() {
    return this.request('/schedules/dates');
  }

  async getMetadata(date) {
    return this.request(`/schedules/${date}/metadata`);
  }

  // Updates
  async getNewSchedules(hours = 24) {
    return this.request(`/updates/new?hours=${hours}`);
  }

  async getChangedSchedules(hours = 24) {
    return this.request(`/updates/changed?hours=${hours}`);
  }

  }

  async findExactAddress(address) {
  }
}

module.exports = new BlackoutAPI(process.env.API_URL);
```

---

## –ö–æ–Ω—Ç–∞–∫—Ç–∏ —Ç–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞

**API Repository:** (–≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π)

**–í–µ—Ä—Å—ñ—è API:** 2.0.0

**–û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó:** 22 –ª–∏—Å—Ç–æ–ø–∞–¥–∞ 2025

---

## Changelog API

### v2.0.0
- ‚úÖ –î–æ–¥–∞–Ω–æ –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –¥–ª—è –∞–¥—Ä–µ—Å
- ‚úÖ –ü–æ–∫—Ä–∞—â–µ–Ω–æ rate limiting
- ‚úÖ –î–æ–¥–∞–Ω–æ –º—É–ª—å—Ç–∏–º–æ–≤–Ω—ñ—Å—Ç—å
- ‚úÖ –ù–æ–≤—ñ –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –¥–ª—è updates

### v1.0.0
- ‚úÖ –ë–∞–∑–æ–≤—ñ –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –¥–ª—è –≥—Ä–∞—Ñ—ñ–∫—ñ–≤
- ‚úÖ Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

---

**–£—Å–ø—ñ—à–Ω–æ—ó —Ä–æ–∑—Ä–æ–±–∫–∏! üöÄ**
